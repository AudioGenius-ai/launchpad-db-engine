# @launchpad/db-engine Knowledge Base

Auto-generated documentation of APIs, utilities, patterns, and architectural decisions.

## API Endpoints

N/A - This is a database engine library, not an HTTP service.

## Driver Interface

### Core Driver Methods

| Method | Description | Returns |
|--------|-------------|---------|
| `query<T>(sql, params?)` | Execute SQL query and return rows | `Promise<QueryResult<T>>` |
| `execute(sql, params?)` | Execute SQL statement (INSERT/UPDATE/DELETE) | `Promise<{ rowCount: number }>` |
| `transaction<T>(fn)` | Execute operations in a transaction | `Promise<T>` |
| `close()` | Close all connections immediately | `Promise<void>` |
| `drainAndClose(options?)` | Gracefully shutdown waiting for active queries | `Promise<DrainResult>` |
| `getActiveQueryCount()` | Get number of currently active queries | `number` |
| `isDraining` | Property indicating if driver is draining | `boolean` |

### Health Check Methods (TASK-357)

| Method | Description | Returns |
|--------|-------------|---------|
| `healthCheck()` | Perform immediate health check ping | `Promise<HealthCheckResult>` |
| `getPoolStats()` | Get current connection pool statistics | `PoolStats` |
| `isHealthy()` | Check if last health check passed | `boolean` |
| `startHealthChecks()` | Start periodic health check interval | `void` |
| `stopHealthChecks()` | Stop periodic health checks | `void` |

## Utilities

### Health Check Utilities (`src/driver/health.ts`)

| Function | Purpose | Parameters |
|----------|---------|------------|
| `createHealthCheckResult(healthy, latencyMs, error?)` | Factory for HealthCheckResult objects | `boolean, number, string?` |
| `getDefaultHealthCheckConfig(overrides?)` | Get default health check config with optional overrides | `Partial<HealthCheckConfig>?` |

### Retry Utilities (`src/driver/retry.ts`)

| Function | Purpose | Parameters |
|----------|---------|------------|
| `isRetryableError(error, customErrors?)` | Check if error is retryable (connection errors) | `unknown, string[]?` |
| `withRetry<T>(operation, config?)` | Execute operation with exponential backoff retry | `() => Promise<T>, RetryConfig?` |
| `createTimeoutPromise<T>(timeoutMs)` | Create a promise that rejects after timeout | `number` |

### Pool Monitor (`src/driver/pool-monitor.ts`)

| Function | Purpose | Parameters |
|----------|---------|------------|
| `createPoolMonitor(getStats, config?)` | Create pool exhaustion monitor | `() => PoolStats, PoolMonitorConfig?` |

### Query Tracker (`src/driver/query-tracker.ts`) - TASK-363

| Method | Purpose | Returns |
|--------|---------|---------|
| `trackQuery(id, query, backendPid?)` | Track a new query as active | `void` |
| `untrackQuery(id)` | Mark query as completed | `void` |
| `getActiveCount()` | Get count of active queries | `number` |
| `getActiveQueries()` | Get array of active query info | `QueryInfo[]` |
| `startDrain(timeoutMs)` | Begin drain mode, wait for queries | `Promise<{ timedOut: boolean }>` |
| `markCancelled(id)` | Mark query as cancelled (not completed) | `void` |
| `getStats()` | Get completed/cancelled/active counts | `object` |
| `isDraining()` | Check if in drain mode | `boolean` |
| `reset()` | Reset tracker state | `void` |

### Signal Handler (`src/driver/signal-handler.ts`) - TASK-363

| Function | Purpose | Parameters |
|----------|---------|------------|
| `registerSignalHandlers(driver, options?)` | Register SIGTERM/SIGINT handlers for graceful shutdown | `Driver, SignalHandlerOptions?` |

### Type Generator (`src/types/generator.ts`) - TASK-395

| Function | Purpose | Parameters |
|----------|---------|------------|
| `generateTypes(schemas, options?)` | Generate TypeScript interfaces from schema definitions | `Map<string, SchemaDefinition>, TypeGeneratorOptions?` |
| `generateZodSchemas(schemas, options?)` | Generate Zod validation schemas from schema definitions | `Map<string, SchemaDefinition>, TypeGeneratorOptions?` |
| `generateSchemaFromDefinition(schema)` | Generate schema code from a SchemaDefinition object | `SchemaDefinition` |

### CLI Watch Mode (`src/cli/index.ts`) - TASK-397

| Function | Purpose | Parameters |
|----------|---------|------------|
| `watchAndGenerateTypes(config, options)` | Watch for schema changes and regenerate types automatically | `CliConfig, WatchOptions` |

#### Helper Functions (internal)

| Function | Purpose |
|----------|---------|
| `pgTypeToTs(type)` | Map PostgreSQL column type to TypeScript type |
| `pgTypeToZod(type)` | Map PostgreSQL column type to Zod validator |
| `isAutoGeneratedColumn(colName, col)` | Check if column is auto-generated (id, created_at, updated_at) |
| `pascalCase(str)` | Convert string to PascalCase |
| `camelCase(str)` | Convert string to camelCase |

## CLI Commands

### Type Generation (`types:generate`) - TASK-395, TASK-397

```bash
launchpad-db types:generate [options]
```

| Option | Description | Default |
|--------|-------------|---------|
| `--output` | Output file path | `./generated/types.ts` |
| `--app-id` | Filter schemas by app ID | (all schemas) |
| `--no-insert` | Skip Insert type generation | false |
| `--no-update` | Skip Update type generation | false |
| `--zod` | Generate Zod validation schemas | false |
| `--watch` | Watch for schema changes and regenerate automatically | false |
| `--debounce-ms` | Debounce interval in milliseconds | 500 |

**Generated Types:**
- **Row types**: Full table interface with all columns
- **Insert types**: Omits auto-generated fields (id, created_at, updated_at)
- **Update types**: All fields optional for partial updates

**With `--zod` flag:**
- Zod schemas for runtime validation
- Type inference from schemas (`z.infer<typeof schema>`)
- Separate output file: `types.zod.ts`

**With `--watch` flag (TASK-397):**
- Polls schema registry every 1 second for changes
- Uses checksum-based change detection to avoid unnecessary regeneration
- Debounces regeneration (configurable via `--debounce-ms`)
- Shows timestamped output: `[HH:MM:SS] Schema change detected - Regenerated types (schema1, schema2)`
- Graceful shutdown on SIGINT/SIGTERM with proper resource cleanup

## Types

### TypeGeneratorOptions (TASK-395)
```typescript
interface TypeGeneratorOptions {
  includeInsertTypes?: boolean;  // Default: true
  includeUpdateTypes?: boolean;  // Default: true
  includeZodSchemas?: boolean;   // Default: false
  omitTenantColumns?: boolean;   // Default: true
}
```

### WatchOptions (TASK-397)
```typescript
interface WatchOptions {
  appId?: string;        // Filter schemas by app ID
  outputPath?: string;   // Output file path (default: ./generated/types.ts)
  debounceMs?: number;   // Debounce interval (default: 500ms)
}
```

### DrainOptions (TASK-363)
```typescript
interface DrainOptions {
  timeout?: number;                              // Default: 30000 (30s)
  onProgress?: (progress: DrainProgress) => void;
  forceCancelOnTimeout?: boolean;                // Default: true
}
```

### DrainProgress (TASK-363)
```typescript
type DrainPhase = 'draining' | 'cancelling' | 'closing' | 'complete';

interface DrainProgress {
  phase: DrainPhase;
  activeQueries: number;
  completedQueries: number;
  cancelledQueries: number;
  elapsedMs: number;
}
```

### DrainResult (TASK-363)
```typescript
interface DrainResult {
  success: boolean;
  completedQueries: number;
  cancelledQueries: number;
  elapsedMs: number;
  error?: Error;
}
```

### QueryInfo (TASK-363)
```typescript
interface QueryInfo {
  id: string;
  query: string;           // Truncated to 200 chars
  startedAt: Date;
  backendPid?: number;     // PostgreSQL backend process ID
}
```

### SignalHandlerOptions (TASK-363)
```typescript
interface SignalHandlerOptions {
  timeout?: number;              // Default: 30000 (30s)
  exitCodeSuccess?: number;      // Default: 0
  exitCodeForced?: number;       // Default: 1 (when queries cancelled)
  autoExit?: boolean;            // Default: true
  onShutdownStart?: () => void;
  onShutdownComplete?: (result: DrainResult) => void;
}
```

### HealthCheckResult
```typescript
interface HealthCheckResult {
  healthy: boolean;
  latencyMs: number;
  lastCheckedAt: Date;
  error?: string;
}
```

### PoolStats
```typescript
interface PoolStats {
  totalConnections: number;
  activeConnections: number;
  idleConnections: number;
  waitingRequests: number;
  maxConnections: number;
}
```

### HealthCheckConfig
```typescript
interface HealthCheckConfig {
  enabled?: boolean;           // Default: false
  intervalMs?: number;         // Default: 30000 (30s)
  timeoutMs?: number;          // Default: 5000 (5s)
  onHealthChange?: (healthy: boolean, result: HealthCheckResult) => void;
}
```

### PoolMonitorConfig
```typescript
interface PoolMonitorConfig {
  warningThreshold?: number;   // Default: 0.8 (80%)
  criticalThreshold?: number;  // Default: 0.95 (95%)
  checkIntervalMs?: number;    // Default: 10000 (10s)
  onWarning?: (stats: PoolStats) => void;
  onCritical?: (stats: PoolStats) => void;
  onRecovery?: (stats: PoolStats) => void;
}
```

### RetryConfig
```typescript
interface RetryConfig {
  maxRetries?: number;         // Default: 3
  baseDelayMs?: number;        // Default: 100
  maxDelayMs?: number;         // Default: 5000
  retryableErrors?: string[];  // Additional error codes to retry
}
```

## Patterns

### Graceful Shutdown Pattern (TASK-363)
All drivers implement graceful shutdown with active query tracking:
1. **Track**: All queries are tracked via `QueryTracker` with unique IDs
2. **Drain**: `drainAndClose()` waits for active queries to complete
3. **Cancel**: If timeout exceeded, remaining queries are cancelled:
   - **PostgreSQL**: `SELECT pg_cancel_backend(pid)`
   - **MySQL**: `KILL QUERY <connection_id>`
   - **SQLite**: No cancellation needed (synchronous)
   - **MongoDB**: Session abort
4. **Close**: Connection pool is closed

Usage with signal handlers:
```typescript
import { createDriver, registerSignalHandlers } from '@launchpad/db-engine';

const driver = await createDriver({ connectionString: '...' });

// Register handlers - automatically calls drainAndClose on SIGTERM/SIGINT
const unregister = registerSignalHandlers(driver, {
  timeout: 30000,
  onShutdownStart: () => console.log('Shutting down...'),
  onShutdownComplete: (result) => console.log(`Done in ${result.elapsedMs}ms`),
});
```

### Connection Health Check Pattern
All drivers implement health checks using a simple ping query:
- **PostgreSQL**: `SELECT 1` via postgres.js
- **MySQL**: `pool.getConnection()` + `connection.ping()`
- **SQLite**: `db.prepare('SELECT 1').get()` (synchronous)

Health checks are opt-in via `config.healthCheck.enabled = true`.

### Row-Level Security (RLS) Pattern (TASK-404)
Multi-tenant data isolation using PostgreSQL RLS policies with db-engine context injection:

1. **Context Injection**: `DbClient.transaction()` automatically sets tenant context via `SET LOCAL`
2. **Policy Design**: RLS policies use `current_setting()` to read context
3. **CRUD Coverage**: Separate policies for SELECT, INSERT, UPDATE, DELETE operations
4. **Enforcement**: `FORCE ROW LEVEL SECURITY` ensures policies apply even to table owner

**RLS Policy Template:**
```sql
-- SELECT: Filter visible rows
CREATE POLICY tenant_isolation_select ON table_name FOR SELECT
  USING (
    app_id = current_setting('app.current_app_id', true) AND
    organization_id = current_setting('app.current_org_id', true)
  );

-- INSERT: Validate new data
CREATE POLICY tenant_isolation_insert ON table_name FOR INSERT
  WITH CHECK (
    app_id = current_setting('app.current_app_id', true) AND
    organization_id = current_setting('app.current_org_id', true)
  );

-- UPDATE: Filter + validate
CREATE POLICY tenant_isolation_update ON table_name FOR UPDATE
  USING (app_id = current_setting('app.current_app_id', true) AND
         organization_id = current_setting('app.current_org_id', true))
  WITH CHECK (app_id = current_setting('app.current_app_id', true) AND
              organization_id = current_setting('app.current_org_id', true));

-- DELETE: Filter visible rows
CREATE POLICY tenant_isolation_delete ON table_name FOR DELETE
  USING (
    app_id = current_setting('app.current_app_id', true) AND
    organization_id = current_setting('app.current_org_id', true)
  );
```

**Expected RLS Behavior:**
| Operation | Cross-Tenant Attempt | Result |
|-----------|---------------------|--------|
| SELECT | Query other tenant's data | Returns 0 rows (silent filtering) |
| INSERT | Mismatched tenant columns | WITH CHECK violation error |
| UPDATE | Target other tenant's rows | Affects 0 rows |
| DELETE | Target other tenant's rows | Affects 0 rows |

**Testing with RLS:**
```typescript
// Helper to execute queries with RLS enforcement
async function withRLS<T>(
  tenant: { appId: string; organizationId: string },
  fn: (trx: Transaction) => Promise<T>
): Promise<T> {
  return client.transaction(tenant, async (trx) => {
    await trx.raw(`SET ROLE ${testRole}`);  // Switch to RLS-enforced role
    try {
      return await fn(trx);
    } finally {
      await trx.raw('RESET ROLE');
    }
  });
}
```

### Retry with Exponential Backoff
Connection errors automatically retry with exponential backoff and jitter:
```typescript
const delay = Math.min(baseDelayMs * Math.pow(2, attempt), maxDelayMs);
const jitter = Math.random() * delay * 0.1;
```

Default retryable errors include:
- Network: `ECONNREFUSED`, `ETIMEDOUT`, `ECONNRESET`, `EPIPE`, `ENOTCONN`
- PostgreSQL: `57P01`, `57P02`, `57P03` (admin shutdown, crash, cannot connect)
- MySQL: `PROTOCOL_CONNECTION_LOST`, `ER_CON_COUNT_ERROR`

### Pool Exhaustion Detection
Pool monitor tracks utilization and logs warnings/critical alerts:
- **Warning**: 80% pool utilization
- **Critical**: 95% pool utilization
- **Recovery**: Logged when utilization drops below warning threshold

### Type Generation Pattern (TASK-395)
Generates TypeScript types and Zod schemas from registered database schemas:

1. **Row Types**: Full interface matching database table columns
2. **Insert Types**: Omit auto-generated columns (id, created_at, updated_at) and tenant columns
3. **Update Types**: All fields optional except immutable ones (id, created_at)
4. **Zod Schemas**: Runtime validation with proper type coercion

**Column Type Mapping:**
| PostgreSQL | TypeScript | Zod |
|------------|------------|-----|
| `uuid` | `string` | `z.string().uuid()` |
| `string`, `text` | `string` | `z.string()` |
| `integer`, `bigint` | `number` | `z.number().int()` |
| `float`, `decimal` | `number` | `z.number()` |
| `boolean` | `boolean` | `z.boolean()` |
| `datetime`, `date` | `Date` | `z.coerce.date()` |
| `time` | `string` | `z.string()` |
| `json` | `Record<string, unknown>` | `z.record(z.unknown())` |
| `binary` | `Buffer` | `z.instanceof(Buffer)` |

**Example Usage:**
```typescript
// CLI
launchpad-db types:generate --output ./src/db/types.ts --zod

// Programmatic
import { generateTypes, generateZodSchemas } from '@launchpad/db-engine';

const types = generateTypes(schemaMap, {
  includeInsertTypes: true,
  includeUpdateTypes: true,
});

const zodSchemas = generateZodSchemas(schemaMap);
```

### Watch Mode Pattern (TASK-397)
Enables automatic type regeneration during development with efficient change detection:

1. **Polling**: Schema registry is polled every 1 second for changes
2. **Checksum**: JSON hash computed from sorted schema entries to detect changes
3. **Debouncing**: Regeneration is debounced (default 500ms) to batch rapid changes
4. **No-op detection**: If checksum unchanged, regeneration is skipped

**Implementation Details:**
- Checksum uses djb2 hash algorithm for fast computation
- Schemas are sorted alphabetically before hashing for deterministic results
- Signal handlers (SIGINT/SIGTERM) properly cleanup timers and close driver
- Error handling prevents watcher crash on regeneration failure

**Example Usage:**
```bash
# Watch with default settings
launchpad-db types:generate --watch --output ./src/types.ts

# Watch with custom debounce
launchpad-db types:generate --watch --debounce-ms 1000 --output ./src/types.ts

# Watch specific app schemas
launchpad-db types:generate --watch --app-id myapp --output ./src/types.ts
```

## Architecture Decisions

### ADR-001: Opt-in Health Checks
**Context**: Health checks add overhead and may not be needed for all use cases.
**Decision**: Health checks are disabled by default (`enabled: false`).
**Consequence**: Users must explicitly enable health checks in config.

### ADR-002: Backward Compatible Driver Interface
**Context**: Adding health check methods would break existing driver implementations.
**Decision**: All new methods are required on the Driver interface but have sensible defaults.
**Consequence**: Existing code works without changes; health features require explicit usage.

### ADR-003: Driver-Specific Pool Stats
**Context**: Each database driver library exposes pool metrics differently.
**Decision**: Each driver implements `getPoolStats()` using library-specific APIs.
**Consequence**: PostgreSQL (postgres.js) has limited pool visibility compared to MySQL (mysql2).

### ADR-004: Graceful Shutdown with Query Tracking (TASK-363)
**Context**: `close()` immediately terminates connections, potentially failing in-flight queries.
**Decision**: Add `drainAndClose()` that waits for active queries before closing, with database-specific cancellation.
**Consequence**: Production deployments can gracefully handle SIGTERM without losing query results. Adds slight overhead from query tracking.

### ADR-005: Centralized QueryTracker (TASK-363)
**Context**: Each driver needs to track active queries for graceful shutdown.
**Decision**: Create shared `QueryTracker` class used by all drivers.
**Consequence**: Consistent tracking behavior across PostgreSQL, MySQL, SQLite, MongoDB. Rejects new queries once draining starts.

### ADR-006: Separate Insert/Update Types (TASK-395)
**Context**: TypeScript types generated from database schemas should distinguish between row reads, inserts, and updates.
**Decision**: Generate three type variants per table: `TableName` (row), `TableNameInsert` (omits auto-fields), `TableNameUpdate` (all optional).
**Consequence**: Type-safe database operations with compile-time validation of required fields. Zod schemas provide runtime validation.

### ADR-007: Zod as Optional Peer Dependency (TASK-395)
**Context**: Zod schemas are useful for runtime validation but not all users need them.
**Decision**: Make `zod` an optional peer dependency; only generate Zod schemas when `--zod` flag is passed.
**Consequence**: No runtime dependency added unless explicitly requested. Separate output file prevents import errors when zod not installed.

### ADR-008: Polling-Based Schema Watching (TASK-397)
**Context**: Watch mode needs to detect schema changes for automatic type regeneration. Options: file system watching, database triggers, or polling.
**Decision**: Use polling (1 second interval) against schema registry with checksum-based change detection.
**Consequence**: Simple and reliable implementation that works across all environments. Minimal overhead due to checksum comparison skipping unchanged schemas. Trade-off: 1 second latency for change detection.

### ADR-009: RLS Testing with Separate Database Role (TASK-404)
**Context**: Testing RLS policies requires queries to be subject to policy enforcement, but PostgreSQL table owners bypass RLS by default.
**Decision**: Create a dedicated test role (`test_rls_user`) with no login, grant table permissions, and use `SET ROLE` within transactions to execute queries as that role.
**Consequence**: Accurate RLS enforcement testing without modifying production code. `FORCE ROW LEVEL SECURITY` on test tables ensures even superuser queries go through RLS when using `SET ROLE`. Role cleanup in `afterAll` prevents test pollution.

## Test Fixtures

### SQL Injection Prevention (`tests/fixtures/special-characters.ts`)

| Export | Purpose |
|--------|---------|
| `SQL_INJECTION_PAYLOADS` | 15 common SQL injection attack patterns for testing |
| `UNICODE_EDGE_CASES` | 12 unicode edge cases (NULL byte, BOM, emoji, CJK, etc.) |
| `SPECIAL_SQL_CHARACTERS` | 13 special SQL characters (quotes, semicolons, comments, etc.) |
| `LARGE_DATASET_GENERATORS` | Functions to generate test data (IDs, strings, rows) |
| `BOUNDARY_VALUES` | Integer and string boundary values for edge case testing |

### LARGE_DATASET_GENERATORS
```typescript
{
  generateIds(count: number): number[]        // [1, 2, 3, ...]
  generateStrings(count: number): string[]    // ["item_0", "item_1", ...]
  generateRows(count: number): Array<{name, email}>
  generateRowsWithId(count: number): Array<{id, name, value}>
}
```

### BOUNDARY_VALUES
```typescript
{
  integers: {
    maxInt32: 2147483647,
    minInt32: -2147483648,
    maxBigInt: BigInt('9223372036854775807'),
    minBigInt: BigInt('-9223372036854775808'),
    zero: 0,
    negativeOne: -1
  },
  strings: {
    empty: '',
    singleChar: 'a',
    maxLength: 'a'.repeat(10000),
    whitespaceOnly: '   ',
    unicode: 'ðŸŽ‰ðŸ”¥ðŸ’¯'
  },
  arrays: {
    empty: [],
    single: [1],
    large: Array.from({length: 1000}, (_, i) => i)
  }
}
```

## Recent Changes

- **[TASK-404]**: Added RLS policy enforcement integration tests for PostgreSQL driver
  - Created comprehensive test suite verifying Row-Level Security enforcement with db-engine
  - 21 integration tests covering all CRUD operations and transaction contexts
  - Test categories:
    - SELECT Enforcement (5 tests): Tenant isolation, cross-tenant filtering, COUNT leakage prevention
    - INSERT Enforcement (4 tests): WITH CHECK validation, mismatched app_id/organization_id rejection
    - UPDATE Enforcement (4 tests): Row visibility filtering, 0-row updates for cross-tenant, tenant column change prevention
    - DELETE Enforcement (3 tests): Tenant-scoped deletion, cross-tenant protection
    - Transaction Context (5 tests): Multi-operation transactions, rollback isolation, sequential tenant switching
  - Implemented `withRLS()` helper for testing queries under RLS enforcement
  - Created test table `test_rls_documents` with FORCE ROW LEVEL SECURITY
  - Defined 4 RLS policies (SELECT, INSERT, UPDATE, DELETE) using `current_setting()` for context
  - Test fixtures with TENANT_A (3 docs) and TENANT_B (2 docs) for isolation testing
  - All tests pass on Node 18, 20, 22 in CI
  - Files created:
    - `tests/integration/postgresql-rls.test.ts` - RLS enforcement test suite (555 lines)
  - Related spec: SPEC-127 (RLS Policy Enforcement Integration Tests)
  - PR #25: https://github.com/AudioGenius-ai/launchpad-db-engine/pull/25

- **[TASK-397]**: Implemented watch mode for CLI type generation
  - Added `--watch` flag to `types:generate` command for automatic regeneration
  - Added `--debounce-ms` option to configure regeneration debounce (default: 500ms)
  - Implemented polling-based change detection (1 second interval)
  - Added checksum-based comparison using djb2 hash to avoid unnecessary regeneration
  - Implemented graceful shutdown on SIGINT/SIGTERM with proper timer cleanup
  - Added timestamped output showing when types are regenerated
  - Error handling prevents watcher from crashing on regeneration failure
  - Added `WatchOptions` interface exported from CLI module
  - Added `watchAndGenerateTypes()` function for programmatic usage
  - Added 11 unit tests covering debouncing, checksum computation, shutdown handling, and CLI parsing
  - Files changed:
    - `src/cli/bin.ts` - Added --watch and --debounce-ms CLI flags
    - `src/cli/index.ts` - Added watchAndGenerateTypes function with polling and debouncing
    - `src/cli/watch.test.ts` - Unit tests for watch mode (NEW)
  - PR #23: https://github.com/AudioGenius-ai/launchpad-db-engine/pull/23

- **[TASK-395]**: Added Insert/Update type generation with Zod schemas to CLI
  - Extended `generateTypes()` to create InsertType and UpdateType interfaces per table
  - InsertType omits auto-generated columns: `id`, `created_at`, `updated_at`, tenant columns
  - UpdateType makes all fields optional except immutable ones (`id`, `created_at`)
  - Added `generateZodSchemas()` function for runtime validation schemas
  - New CLI flags: `--zod`, `--no-insert`, `--no-update`
  - Added `pgTypeToZod()` mapping for all column types
  - Added `isAutoGeneratedColumn()` helper to detect auto-generated fields
  - Extended `TypeGeneratorOptions` interface with new options
  - Added `zod` as optional peer dependency in package.json
  - Added 23 unit tests for type and Zod schema generation
  - Files changed:
    - `src/types/generator.ts` - Core type generation logic
    - `src/types/generator.test.ts` - Unit tests (NEW)
    - `src/cli/bin.ts` - CLI flags and help text
    - `src/cli/index.ts` - generateTypesFromRegistry() with Zod support
    - `package.json` - zod peer dependency
  - PR #24: https://github.com/AudioGenius-ai/launchpad-db-engine/pull/24

- **[TASK-363]**: Implemented graceful shutdown for database connections
  - Added `drainAndClose(options?)` method to Driver interface
  - Added `getActiveQueryCount()` method and `isDraining` property
  - Created `QueryTracker` class (`src/driver/query-tracker.ts`) for tracking active queries
  - Created `registerSignalHandlers()` utility (`src/driver/signal-handler.ts`) for SIGTERM/SIGINT handling
  - New types: `DrainOptions`, `DrainProgress`, `DrainResult`, `DrainPhase`, `QueryInfo`, `SignalHandlerOptions`
  - All drivers (PostgreSQL, MySQL, SQLite, MongoDB) implement graceful shutdown
  - Database-specific query cancellation:
    - PostgreSQL: `pg_cancel_backend(pid)`
    - MySQL: `KILL QUERY <id>`
    - SQLite: No cancellation (synchronous)
    - MongoDB: Session abort
  - Added 40 unit tests (17 QueryTracker, 13 signal handler, 10 mock integration)
  - PR #21: https://github.com/AudioGenius-ai/launchpad-db-engine/pull/21

- **[TASK-362]**: Added comprehensive edge case test coverage for query builder and compiler
  - Created `tests/fixtures/special-characters.ts` with SQL injection payloads, unicode edge cases, and boundary values
  - Added 32 query builder unit tests (`src/query-builder/edge-cases.test.ts`):
    - Complex nested WHERE conditions (5 tests)
    - JOIN with multiple aliases (6 tests)
    - GROUP BY + HAVING edge cases (6 tests)
    - Batch insert edge cases (10 tests)
    - Update/Delete builder edge cases (5 tests)
  - Added 74 compiler unit tests (`src/compiler/edge-cases.test.ts`):
    - Large IN clause compilation (6 tests)
    - SQL injection prevention (15+ attack patterns)
    - Unicode edge cases (12 characters)
    - Special SQL characters (10+ characters)
    - Boundary values (7 tests)
    - Complex query compilation (5 tests)
    - Insert many compilation (5 tests)
    - MySQL/SQLite dialect edge cases (6 tests)
    - Error handling edge cases (4 tests)
    - Tenant injection edge cases (2 tests)
  - Added 27 integration tests (`tests/integration/edge-cases.test.ts`):
    - Transaction rollback scenarios (6 tests)
    - Large dataset operations (4 tests)
    - SQL injection prevention integration (3 tests)
    - Unicode and special characters (3 tests)
    - Boundary value tests (7 tests)
    - Complex query scenarios (5 tests)
  - Total: 133 new tests enhancing security and edge case coverage

- **[TASK-357]**: Implemented connection pool health checks for all database drivers
  - Added `healthCheck()`, `getPoolStats()`, `isHealthy()`, `startHealthChecks()`, `stopHealthChecks()` to Driver interface
  - Created health check utilities (`src/driver/health.ts`)
  - Created retry logic with exponential backoff (`src/driver/retry.ts`)
  - Created pool exhaustion monitor (`src/driver/pool-monitor.ts`)
  - Added 45 unit tests (12 health, 18 pool-monitor, 15 retry)
  - PostgreSQL, MySQL, SQLite drivers all implement health check interface

- **[TASK-273]**: Implemented seed data management system
- **[TASK-140]**: Added MongoDB driver support
- **[TASK-226]**: Implemented database branching for preview environments
